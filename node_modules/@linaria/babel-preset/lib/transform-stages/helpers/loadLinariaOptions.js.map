{"version":3,"file":"loadLinariaOptions.js","names":["explorer","cosmiconfig","cache","WeakMap","loadLinariaOptions","overrides","has","get","configFile","ignore","rules","babelOptions","rest","result","undefined","loadSync","searchSync","options","displayName","evaluate","extensions","action","require","resolve","test","filename","code","config","set"],"sources":["../../../src/transform-stages/helpers/loadLinariaOptions.ts"],"sourcesContent":["import cosmiconfig from 'cosmiconfig';\n\nimport type { StrictOptions } from '@linaria/utils';\n\nimport type { Stage } from '../../types';\n\nexport type PluginOptions = StrictOptions & {\n  configFile?: string;\n  stage?: Stage;\n};\n\nconst explorer = cosmiconfig('linaria');\n\nconst cache = new WeakMap<Partial<PluginOptions>, StrictOptions>();\n\nexport default function loadLinariaOptions(\n  overrides: Partial<PluginOptions> = {}\n): StrictOptions {\n  if (cache.has(overrides)) {\n    return cache.get(overrides)!;\n  }\n\n  const { configFile, ignore, rules, babelOptions = {}, ...rest } = overrides;\n\n  const result =\n    configFile !== undefined\n      ? explorer.loadSync(configFile)\n      : explorer.searchSync();\n\n  const options = {\n    displayName: false,\n    evaluate: true,\n    extensions: ['.json', '.js', '.jsx', '.ts', '.tsx'],\n    rules: rules ?? [\n      {\n        action: require.resolve('@linaria/shaker'),\n      },\n      {\n        // The old `ignore` option is used as a default value for `ignore` rule.\n        test: ignore ?? /[\\\\/]node_modules[\\\\/]/,\n        action: 'ignore',\n      },\n      {\n        // Do not ignore ES-modules\n        test: (filename, code) => {\n          if (!/\\/node_modules\\//.test(filename)) {\n            return false;\n          }\n\n          return /(?:^|\\n|;)\\s*(?:export|import)\\s+/.test(code);\n        },\n        action: require.resolve('@linaria/shaker'),\n      },\n    ],\n    babelOptions,\n    ...(result ? result.config : null),\n    ...rest,\n  };\n\n  cache.set(overrides, options);\n\n  return options;\n}\n"],"mappings":";;;;;;;AAAA;;;;AAWA,MAAMA,QAAQ,GAAG,IAAAC,oBAAA,EAAY,SAAZ,CAAjB;AAEA,MAAMC,KAAK,GAAG,IAAIC,OAAJ,EAAd;;AAEe,SAASC,kBAAT,CACbC,SAAiC,GAAG,EADvB,EAEE;EACf,IAAIH,KAAK,CAACI,GAAN,CAAUD,SAAV,CAAJ,EAA0B;IACxB,OAAOH,KAAK,CAACK,GAAN,CAAUF,SAAV,CAAP;EACD;;EAED,MAAM;IAAEG,UAAF;IAAcC,MAAd;IAAsBC,KAAtB;IAA6BC,YAAY,GAAG,EAA5C;IAAgD,GAAGC;EAAnD,IAA4DP,SAAlE;EAEA,MAAMQ,MAAM,GACVL,UAAU,KAAKM,SAAf,GACId,QAAQ,CAACe,QAAT,CAAkBP,UAAlB,CADJ,GAEIR,QAAQ,CAACgB,UAAT,EAHN;EAKA,MAAMC,OAAO,GAAG;IACdC,WAAW,EAAE,KADC;IAEdC,QAAQ,EAAE,IAFI;IAGdC,UAAU,EAAE,CAAC,OAAD,EAAU,KAAV,EAAiB,MAAjB,EAAyB,KAAzB,EAAgC,MAAhC,CAHE;IAIdV,KAAK,EAAEA,KAAF,aAAEA,KAAF,cAAEA,KAAF,GAAW,CACd;MACEW,MAAM,EAAEC,OAAO,CAACC,OAAR,CAAgB,iBAAhB;IADV,CADc,EAId;MACE;MACAC,IAAI,EAAEf,MAAF,aAAEA,MAAF,cAAEA,MAAF,GAAY,wBAFlB;MAGEY,MAAM,EAAE;IAHV,CAJc,EASd;MACE;MACAG,IAAI,EAAE,CAACC,QAAD,EAAWC,IAAX,KAAoB;QACxB,IAAI,CAAC,mBAAmBF,IAAnB,CAAwBC,QAAxB,CAAL,EAAwC;UACtC,OAAO,KAAP;QACD;;QAED,OAAO,oCAAoCD,IAApC,CAAyCE,IAAzC,CAAP;MACD,CARH;MASEL,MAAM,EAAEC,OAAO,CAACC,OAAR,CAAgB,iBAAhB;IATV,CATc,CAJF;IAyBdZ,YAzBc;IA0Bd,IAAIE,MAAM,GAAGA,MAAM,CAACc,MAAV,GAAmB,IAA7B,CA1Bc;IA2Bd,GAAGf;EA3BW,CAAhB;EA8BAV,KAAK,CAAC0B,GAAN,CAAUvB,SAAV,EAAqBY,OAArB;EAEA,OAAOA,OAAP;AACD"}
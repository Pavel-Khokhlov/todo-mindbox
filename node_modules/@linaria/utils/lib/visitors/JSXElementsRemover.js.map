{"version":3,"file":"JSXElementsRemover.js","names":["getFunctionName","path","isClassMethod","t","isIdentifier","node","key","name","JSXElementsRemover","nullLiteral","functionScope","scope","getFunctionParent","scopePath","isFunction","emptyBody","blockStatement","returnStatement","decl","findParent","p","isClassDeclaration","mutate","replaceWith","functionDeclaration","id","body","get","Array","isArray","Error","params"],"sources":["../../src/visitors/JSXElementsRemover.ts"],"sourcesContent":["import { types as t } from '@babel/core';\nimport type { NodePath } from '@babel/traverse';\nimport type {\n  CallExpression,\n  Function as FunctionNode,\n  JSX,\n} from '@babel/types';\n\nimport { mutate } from '../scopeHelpers';\n\nfunction getFunctionName(path: NodePath<FunctionNode>): string | null {\n  if (path.isClassMethod() && t.isIdentifier(path.node.key)) {\n    return path.node.key.name;\n  }\n\n  return null;\n}\n\nexport default function JSXElementsRemover(\n  path: NodePath<JSX | CallExpression>\n) {\n  // JSX can be safely replaced with null because it is unnecessary for styles\n  const nullLiteral = t.nullLiteral();\n\n  // We can do even more\n  // If that JSX is a result of a function, we can replace the function body.\n  const functionScope = path.scope.getFunctionParent();\n  const scopePath = functionScope?.path;\n  if (scopePath?.isFunction()) {\n    const emptyBody = t.blockStatement([t.returnStatement(nullLiteral)]);\n\n    // Is it not just a function, but a method `render`?\n    if (getFunctionName(scopePath) === 'render') {\n      const decl = scopePath.findParent((p) => p.isClassDeclaration());\n\n      // Replace the whole component\n      if (decl?.isClassDeclaration()) {\n        mutate(decl, (p) => {\n          p.replaceWith(t.functionDeclaration(decl.node.id, [], emptyBody));\n        });\n\n        return;\n      }\n    }\n\n    const body = scopePath.get('body');\n    if (Array.isArray(body)) {\n      throw new Error(\n        \"A body of a function is expected to be a single element but an array was returned. It's possible if JS syntax has been changed since that code was written.\"\n      );\n    }\n\n    const node: typeof scopePath.node = {\n      ...scopePath.node,\n      body: emptyBody,\n      params: [],\n    };\n\n    mutate(scopePath, (p) => {\n      p.replaceWith(node);\n    });\n  } else {\n    mutate(path, (p) => {\n      p.replaceWith(nullLiteral);\n    });\n  }\n}\n"],"mappings":";;;;;;;AAAA;;AAQA;;AAEA,SAASA,eAAT,CAAyBC,IAAzB,EAAsE;EACpE,IAAIA,IAAI,CAACC,aAAL,MAAwBC,WAAA,CAAEC,YAAF,CAAeH,IAAI,CAACI,IAAL,CAAUC,GAAzB,CAA5B,EAA2D;IACzD,OAAOL,IAAI,CAACI,IAAL,CAAUC,GAAV,CAAcC,IAArB;EACD;;EAED,OAAO,IAAP;AACD;;AAEc,SAASC,kBAAT,CACbP,IADa,EAEb;EACA;EACA,MAAMQ,WAAW,GAAGN,WAAA,CAAEM,WAAF,EAApB,CAFA,CAIA;EACA;;;EACA,MAAMC,aAAa,GAAGT,IAAI,CAACU,KAAL,CAAWC,iBAAX,EAAtB;EACA,MAAMC,SAAS,GAAGH,aAAH,aAAGA,aAAH,uBAAGA,aAAa,CAAET,IAAjC;;EACA,IAAIY,SAAJ,aAAIA,SAAJ,eAAIA,SAAS,CAAEC,UAAX,EAAJ,EAA6B;IAC3B,MAAMC,SAAS,GAAGZ,WAAA,CAAEa,cAAF,CAAiB,CAACb,WAAA,CAAEc,eAAF,CAAkBR,WAAlB,CAAD,CAAjB,CAAlB,CAD2B,CAG3B;;;IACA,IAAIT,eAAe,CAACa,SAAD,CAAf,KAA+B,QAAnC,EAA6C;MAC3C,MAAMK,IAAI,GAAGL,SAAS,CAACM,UAAV,CAAsBC,CAAD,IAAOA,CAAC,CAACC,kBAAF,EAA5B,CAAb,CAD2C,CAG3C;;MACA,IAAIH,IAAJ,aAAIA,IAAJ,eAAIA,IAAI,CAAEG,kBAAN,EAAJ,EAAgC;QAC9B,IAAAC,oBAAA,EAAOJ,IAAP,EAAcE,CAAD,IAAO;UAClBA,CAAC,CAACG,WAAF,CAAcpB,WAAA,CAAEqB,mBAAF,CAAsBN,IAAI,CAACb,IAAL,CAAUoB,EAAhC,EAAoC,EAApC,EAAwCV,SAAxC,CAAd;QACD,CAFD;QAIA;MACD;IACF;;IAED,MAAMW,IAAI,GAAGb,SAAS,CAACc,GAAV,CAAc,MAAd,CAAb;;IACA,IAAIC,KAAK,CAACC,OAAN,CAAcH,IAAd,CAAJ,EAAyB;MACvB,MAAM,IAAII,KAAJ,CACJ,6JADI,CAAN;IAGD;;IAED,MAAMzB,IAA2B,GAAG,EAClC,GAAGQ,SAAS,CAACR,IADqB;MAElCqB,IAAI,EAAEX,SAF4B;MAGlCgB,MAAM,EAAE;IAH0B,CAApC;IAMA,IAAAT,oBAAA,EAAOT,SAAP,EAAmBO,CAAD,IAAO;MACvBA,CAAC,CAACG,WAAF,CAAclB,IAAd;IACD,CAFD;EAGD,CAjCD,MAiCO;IACL,IAAAiB,oBAAA,EAAOrB,IAAP,EAAcmB,CAAD,IAAO;MAClBA,CAAC,CAACG,WAAF,CAAcd,WAAd;IACD,CAFD;EAGD;AACF"}
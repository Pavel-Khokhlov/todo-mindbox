{"version":3,"file":"asyncResolveFallback.js","names":["path","safeResolve","name","where","require","resolve","paths","e","suffixes","reduce","acc","ext","push","syncResolve","what","importer","stack","map","p","dirname","resolved","Error","suffix","resolvedWithSuffix","asyncResolve","Promise"],"sources":["../src/asyncResolveFallback.ts"],"sourcesContent":["import path from 'path';\n\nconst safeResolve = (name: string, where: string[]): string | Error => {\n  try {\n    return require.resolve(name, {\n      paths: where,\n    });\n  } catch (e: unknown) {\n    return e as Error;\n  }\n};\n\nconst suffixes = ['.js', '.ts', '.jsx', '.tsx'].reduce((acc: string[], ext) => {\n  acc.push(`/index${ext}`);\n  acc.push(ext);\n  return acc;\n}, []);\n\nexport const syncResolve = (\n  what: string,\n  importer: string,\n  stack: string[]\n) => {\n  const where = [importer, ...stack].map((p) => path.dirname(p));\n  const resolved = safeResolve(what, where);\n  if (!(resolved instanceof Error)) {\n    return resolved;\n  }\n\n  // eslint-disable-next-line no-restricted-syntax\n  for (const suffix of suffixes) {\n    const resolvedWithSuffix = safeResolve(what + suffix, where);\n    if (resolvedWithSuffix instanceof Error) {\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    return resolvedWithSuffix;\n  }\n\n  throw resolved;\n};\n\nconst asyncResolve = (what: string, importer: string, stack: string[]) => {\n  const where = [importer, ...stack].map((p) => path.dirname(p));\n  const resolved = safeResolve(what, where);\n  if (!(resolved instanceof Error)) {\n    return Promise.resolve(resolved);\n  }\n\n  // eslint-disable-next-line no-restricted-syntax\n  for (const suffix of suffixes) {\n    const resolvedWithSuffix = safeResolve(what + suffix, where);\n    if (resolvedWithSuffix instanceof Error) {\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    return Promise.resolve(resolvedWithSuffix);\n  }\n\n  throw resolved;\n};\n\nexport default asyncResolve;\n"],"mappings":"AAAA,OAAOA,IAAP,MAAiB,MAAjB;;AAEA,MAAMC,WAAW,GAAG,CAACC,IAAD,EAAeC,KAAf,KAAmD;EACrE,IAAI;IACF,OAAOC,OAAO,CAACC,OAAR,CAAgBH,IAAhB,EAAsB;MAC3BI,KAAK,EAAEH;IADoB,CAAtB,CAAP;EAGD,CAJD,CAIE,OAAOI,CAAP,EAAmB;IACnB,OAAOA,CAAP;EACD;AACF,CARD;;AAUA,MAAMC,QAAQ,GAAG,CAAC,KAAD,EAAQ,KAAR,EAAe,MAAf,EAAuB,MAAvB,EAA+BC,MAA/B,CAAsC,CAACC,GAAD,EAAgBC,GAAhB,KAAwB;EAC7ED,GAAG,CAACE,IAAJ,CAAU,SAAQD,GAAI,EAAtB;EACAD,GAAG,CAACE,IAAJ,CAASD,GAAT;EACA,OAAOD,GAAP;AACD,CAJgB,EAId,EAJc,CAAjB;AAMA,OAAO,MAAMG,WAAW,GAAG,CACzBC,IADyB,EAEzBC,QAFyB,EAGzBC,KAHyB,KAItB;EACH,MAAMb,KAAK,GAAG,CAACY,QAAD,EAAW,GAAGC,KAAd,EAAqBC,GAArB,CAA0BC,CAAD,IAAOlB,IAAI,CAACmB,OAAL,CAAaD,CAAb,CAAhC,CAAd;EACA,MAAME,QAAQ,GAAGnB,WAAW,CAACa,IAAD,EAAOX,KAAP,CAA5B;;EACA,IAAI,EAAEiB,QAAQ,YAAYC,KAAtB,CAAJ,EAAkC;IAChC,OAAOD,QAAP;EACD,CALE,CAOH;;;EACA,KAAK,MAAME,MAAX,IAAqBd,QAArB,EAA+B;IAC7B,MAAMe,kBAAkB,GAAGtB,WAAW,CAACa,IAAI,GAAGQ,MAAR,EAAgBnB,KAAhB,CAAtC;;IACA,IAAIoB,kBAAkB,YAAYF,KAAlC,EAAyC;MACvC;MACA;IACD;;IAED,OAAOE,kBAAP;EACD;;EAED,MAAMH,QAAN;AACD,CAvBM;;AAyBP,MAAMI,YAAY,GAAG,CAACV,IAAD,EAAeC,QAAf,EAAiCC,KAAjC,KAAqD;EACxE,MAAMb,KAAK,GAAG,CAACY,QAAD,EAAW,GAAGC,KAAd,EAAqBC,GAArB,CAA0BC,CAAD,IAAOlB,IAAI,CAACmB,OAAL,CAAaD,CAAb,CAAhC,CAAd;EACA,MAAME,QAAQ,GAAGnB,WAAW,CAACa,IAAD,EAAOX,KAAP,CAA5B;;EACA,IAAI,EAAEiB,QAAQ,YAAYC,KAAtB,CAAJ,EAAkC;IAChC,OAAOI,OAAO,CAACpB,OAAR,CAAgBe,QAAhB,CAAP;EACD,CALuE,CAOxE;;;EACA,KAAK,MAAME,MAAX,IAAqBd,QAArB,EAA+B;IAC7B,MAAMe,kBAAkB,GAAGtB,WAAW,CAACa,IAAI,GAAGQ,MAAR,EAAgBnB,KAAhB,CAAtC;;IACA,IAAIoB,kBAAkB,YAAYF,KAAlC,EAAyC;MACvC;MACA;IACD;;IAED,OAAOI,OAAO,CAACpB,OAAR,CAAgBkB,kBAAhB,CAAP;EACD;;EAED,MAAMH,QAAN;AACD,CAnBD;;AAqBA,eAAeI,YAAf"}